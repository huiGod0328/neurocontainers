name: bart
version: 0.8.00   

copyright:
  - license: BSD-3-Clause
    url: https://github.com/mrirecon/bart/blob/master/LICENSE

architectures:
  - x86_64

auto_update:
  method: github_release
  repo: mrirecon/bart  

build:
  kind: neurodocker
  base-image: docker.io/nvidia/cuda:12.0.0-devel-ubuntu22.04
  pkg-manager: apt

  directives:
    - install:
        - make
        - gcc
        - libfftw3-dev
        - liblapacke-dev
        - libpng-dev
        - libopenblas-dev

    - workdir: /opt/bart-{{ context.version }}/

    - run:
        - curl -fsSL --retry 5 https://github.com/mrirecon/bart/archive/v{{ context.version }}.tar.gz | tar -xz -C /opt/bart-{{ context.version }}/ --strip-components 1

    - run:
        - CUDA_BASE=/usr/local/cuda/ CUDA_LIB=lib64 CUDA=1 make -j 8

    - environment:
        PATH: /opt/bart-{{ context.version }}:/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin:~/.local/bin
        TOOLBOX_PATH: /opt/bart-{{ context.version }}/

deploy:
  path:
    - /opt/bart-{{ context.version }}/

readme: |-
  ----------------------------------
  ## bart/{{ context.version }} ##

  BART (Berkeley Advanced Reconstruction Toolbox) is an open-source toolbox for computational magnetic resonance imaging (MRI) reconstruction and related image processing tasks.  
  It provides a large collection of fast, GPU-enabled command-line tools for iterative reconstruction, parallel imaging, compressed sensing, and quantitative MRI.
